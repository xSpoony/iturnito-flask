{% extends 'layouts/paciente.html' %}

{# --- ¡LA CORRECCIÓN ESTÁ AQUÍ! --- #}
{# 1. Define el 'title' (para la pestaña del navegador) #}
{% block title %}Panel Principal{% endblock %}

{# 2. Define el 'header' (para el <h1> de la página) #}
{% block header %}Panel Principal{% endblock %}

{% block main_content %}
<div class="space-y-4">

    <!-- Próximo Turno Destacado (si existe) -->
    {# Ahora 'proximos_turnos' es una variable que pasamos desde la ruta #}
    {% if proximos_turnos %}
    {% set proximo_turno = proximos_turnos[0] %}
    <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-lg shadow-sm p-4 text-white">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <div>
                    <p class="font-semibold text-base">Próxima Cita</p>
                    <!--
                      --- ¡LA CORRECCIÓN ESTÁ AQUÍ! ---
                      Sintaxis de Jinja2: 'variable.propiedad.propiedad'
                    -->
                    <p class="text-blue-100 text-sm">Dr. {{ proximo_turno.doctor.user.name }}</p>
                    <p class="text-blue-100 text-xs">{{ proximo_turno.doctor.especialidad.nombre }}</p>
                </div>
            </div>
            <div class="text-right">
                <!--
                  Formateo de fecha y hora con strftime de Python
                -->
                <p class="font-bold text-lg">{{ proximo_turno.fecha_hora.strftime('%d/%m') }}</p>
                <p class="text-blue-100 text-sm">{{ proximo_turno.fecha_hora.strftime('%H:%M') }}</p>
            </div>
        </div>

        {# La lógica compleja ahora vive en la ruta de Python #}
        {% if show_videocall_button %}
        <div class="mt-3 pt-3 border-t border-white border-opacity-20">
            <a href="{{ url_for('paciente.videollamada', turno_id=proximo_turno.id) }}"
               class="w-full bg-white text-gray-900 py-2 rounded-lg font-semibold text-center block hover:bg-gray-50 transition-colors">
                Ingresar a Consulta
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}



    <!-- Menú Principal -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <a href="{{ url_for('paciente.mis_turnos') }}"
           class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors border-b border-gray-100">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <span class="font-medium text-gray-800">Mis turnos</span>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>

        <a href="{{ url_for('paciente.reservar_turno') }}"
           class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors border-b border-gray-100">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    </svg>
                </div>
                <span class="font-medium text-gray-800">Reservar turno</span>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>

        <a href="{{ url_for('paciente.perfil') }}"
           class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors border-b border-gray-100">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <span class="font-medium text-gray-800">Perfil</span>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>

        <a href="{{ url_for('auth.logout') }}"
           class="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors text-left">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </div>
                <span class="font-medium text-gray-800">Cerrar sesión</span>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
// (El script de la plantilla original de Laravel)
function mostrarAyuda() {
    if (typeof window.mostrarMensaje === 'function') {
        window.mostrarMensaje('Contacte a soporte para obtener ayuda: +54 11 1234-5678', 'info');
    } else {
        alert('Contacte a soporte para obtener ayuda: +54 11 1234-5678');
    }
}

function contactarSoporte() {
    const telefono = '+5411123456789';
    if (confirm('¿Desea llamar a soporte médico?')) {
        window.location.href = `tel:${telefono}`;
    }
}
</script>
{% endblock %}

